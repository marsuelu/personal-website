var S=Object.defineProperty;var k=(n,t,i)=>t in n?S(n,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[t]=i;var s=(n,t,i)=>k(n,typeof t!="symbol"?t+"":t,i);function x(n){return Math.abs(Math.floor(n))}function u(n,t){return Math.random()*(t-n)+n}function o(n,t){return Math.floor(u(n,t+1))}function m(n,t,i,e){const h=Math.pow;return Math.sqrt(h(n-i,2)+h(t-e,2))}function g(n,t,i=1){if(n>360||n<0)throw new Error(`Expected hue 0-360 range, got \`${n}\``);if(t>100||t<0)throw new Error(`Expected lightness 0-100 range, got \`${t}\``);if(i>1||i<0)throw new Error(`Expected alpha 0-1 range, got \`${i}\``);return`hsla(${n}, 100%, ${t}%, ${i})`}const y=n=>{if(typeof n=="object"&&n!==null){if(typeof Object.getPrototypeOf=="function"){const t=Object.getPrototypeOf(n);return t===Object.prototype||t===null}return Object.prototype.toString.call(n)==="[object Object]"}return!1},O=["__proto__","constructor","prototype"],v=(...n)=>n.reduce((t,i)=>(Object.keys(i).forEach(e=>{O.includes(e)||(Array.isArray(t[e])&&Array.isArray(i[e])?t[e]=i[e]:y(t[e])&&y(i[e])?t[e]=v(t[e],i[e]):t[e]=i[e])}),t),{});function E(n,t){let i;return(...e)=>{i&&clearTimeout(i),i=setTimeout(()=>n(...e),t)}}class L{constructor({x:t,y:i,ctx:e,hue:h,decay:a,gravity:r,friction:c,brightness:p,flickering:l,lineWidth:d,explosionLength:f}){s(this,"x");s(this,"y");s(this,"ctx");s(this,"hue");s(this,"friction");s(this,"gravity");s(this,"flickering");s(this,"lineWidth");s(this,"explosionLength");s(this,"angle");s(this,"speed");s(this,"brightness");s(this,"coordinates",[]);s(this,"decay");s(this,"alpha",1);for(this.x=t,this.y=i,this.ctx=e,this.hue=h,this.gravity=r,this.friction=c,this.flickering=l,this.lineWidth=d,this.explosionLength=f,this.angle=u(0,Math.PI*2),this.speed=o(1,10),this.brightness=o(p.min,p.max),this.decay=u(a.min,a.max);this.explosionLength--;)this.coordinates.push([t,i])}update(t){this.coordinates.pop(),this.coordinates.unshift([this.x,this.y]),this.speed*=this.friction,this.x+=Math.cos(this.angle)*this.speed,this.y+=Math.sin(this.angle)*this.speed+this.gravity,this.alpha-=this.decay,this.alpha<=this.decay&&t()}draw(){const t=this.coordinates.length-1;this.ctx.beginPath(),this.ctx.lineWidth=this.lineWidth,this.ctx.fillStyle=g(this.hue,this.brightness,this.alpha),this.ctx.moveTo(this.coordinates[t][0],this.coordinates[t][1]),this.ctx.lineTo(this.x,this.y),this.ctx.strokeStyle=g(this.hue,this.flickering?u(0,this.brightness):this.brightness,this.alpha),this.ctx.stroke()}}class z{constructor(t,i){s(this,"active",!1);s(this,"x");s(this,"y");this.options=t,this.canvas=i,this.pointerDown=this.pointerDown.bind(this),this.pointerUp=this.pointerUp.bind(this),this.pointerMove=this.pointerMove.bind(this)}get mouseOptions(){return this.options.mouse}mount(){this.canvas.addEventListener("pointerdown",this.pointerDown),this.canvas.addEventListener("pointerup",this.pointerUp),this.canvas.addEventListener("pointermove",this.pointerMove)}unmount(){this.canvas.removeEventListener("pointerdown",this.pointerDown),this.canvas.removeEventListener("pointerup",this.pointerUp),this.canvas.removeEventListener("pointermove",this.pointerMove)}usePointer(t,i){const{click:e,move:h}=this.mouseOptions;(e||h)&&(this.x=t.pageX-this.canvas.offsetLeft,this.y=t.pageY-this.canvas.offsetTop,this.active=i)}pointerDown(t){this.usePointer(t,this.mouseOptions.click)}pointerUp(t){this.usePointer(t,!1)}pointerMove(t){this.usePointer(t,this.active)}}class M{constructor(){s(this,"hue");s(this,"rocketsPoint");s(this,"opacity");s(this,"acceleration");s(this,"friction");s(this,"gravity");s(this,"particles");s(this,"explosion");s(this,"mouse");s(this,"boundaries");s(this,"sound");s(this,"delay");s(this,"brightness");s(this,"decay");s(this,"flickering");s(this,"intensity");s(this,"traceLength");s(this,"traceSpeed");s(this,"lineWidth");s(this,"lineStyle");s(this,"autoresize");this.autoresize=!0,this.lineStyle="round",this.flickering=50,this.traceLength=3,this.traceSpeed=10,this.intensity=30,this.explosion=5,this.gravity=1.5,this.opacity=.5,this.particles=50,this.friction=.95,this.acceleration=1.05,this.hue={min:0,max:360},this.rocketsPoint={min:50,max:50},this.lineWidth={explosion:{min:1,max:3},trace:{min:1,max:2}},this.mouse={click:!1,move:!1,max:1},this.delay={min:30,max:60},this.brightness={min:50,max:80},this.decay={min:.015,max:.03},this.sound={enabled:!1,files:["explosion0.mp3","explosion1.mp3","explosion2.mp3"],volume:{min:4,max:8}},this.boundaries={debug:!1,height:0,width:0,x:50,y:50}}update(t){Object.assign(this,v(this,t))}}class C{constructor(t,i){s(this,"tick",0);s(this,"rafId",0);s(this,"fps",60);s(this,"tolerance",.1);s(this,"now");this.options=t,this.render=i}mount(){this.now=performance.now();const t=1e3/this.fps,i=e=>{this.rafId=requestAnimationFrame(i);const h=e-this.now;h>=t-this.tolerance&&(this.render(),this.now=e-h%t,this.tick+=h*(this.options.intensity*Math.PI)/1e3)};this.rafId=requestAnimationFrame(i)}unmount(){cancelAnimationFrame(this.rafId)}}class T{constructor(t,i,e){s(this,"resizer");this.options=t,this.updateSize=i,this.container=e}mount(){if(!this.resizer){const t=E(()=>this.updateSize(),100);this.resizer=new ResizeObserver(t)}this.options.autoresize&&this.resizer.observe(this.container)}unmount(){this.resizer&&this.resizer.unobserve(this.container)}}class P{constructor(t){s(this,"buffers",[]);s(this,"audioContext");s(this,"onInit",!1);this.options=t,this.init()}get isEnabled(){return this.options.sound.enabled}get soundOptions(){return this.options.sound}init(){!this.onInit&&this.isEnabled&&(this.onInit=!0,this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.loadSounds())}async loadSounds(){for(const t of this.soundOptions.files){const i=await(await fetch(t)).arrayBuffer();this.audioContext.decodeAudioData(i).then(e=>{this.buffers.push(e)}).catch(e=>{throw e})}}play(){if(this.isEnabled&&this.buffers.length){const t=this.audioContext.createBufferSource(),i=this.buffers[o(0,this.buffers.length-1)],e=this.audioContext.createGain();t.buffer=i,e.gain.value=u(this.soundOptions.volume.min/100,this.soundOptions.volume.max/100),e.connect(this.audioContext.destination),t.connect(e),t.start(0)}else this.init()}}class A{constructor({x:t,y:i,dx:e,dy:h,ctx:a,hue:r,speed:c,traceLength:p,acceleration:l}){s(this,"x");s(this,"y");s(this,"sx");s(this,"sy");s(this,"dx");s(this,"dy");s(this,"ctx");s(this,"hue");s(this,"speed");s(this,"acceleration");s(this,"traceLength");s(this,"totalDistance");s(this,"angle");s(this,"brightness");s(this,"coordinates",[]);s(this,"currentDistance",0);for(this.x=t,this.y=i,this.sx=t,this.sy=i,this.dx=e,this.dy=h,this.ctx=a,this.hue=r,this.speed=c,this.traceLength=p,this.acceleration=l,this.totalDistance=m(t,i,e,h),this.angle=Math.atan2(h-i,e-t),this.brightness=o(50,70);this.traceLength--;)this.coordinates.push([t,i])}update(t){this.coordinates.pop(),this.coordinates.unshift([this.x,this.y]),this.speed*=this.acceleration;const i=Math.cos(this.angle)*this.speed,e=Math.sin(this.angle)*this.speed;this.currentDistance=m(this.sx,this.sy,this.x+i,this.y+e),this.currentDistance>=this.totalDistance?t(this.dx,this.dy,this.hue):(this.x+=i,this.y+=e)}draw(){const t=this.coordinates.length-1;this.ctx.beginPath(),this.ctx.moveTo(this.coordinates[t][0],this.coordinates[t][1]),this.ctx.lineTo(this.x,this.y),this.ctx.strokeStyle=g(this.hue,this.brightness),this.ctx.stroke()}}class R{constructor(t,i={}){s(this,"target");s(this,"container");s(this,"canvas");s(this,"ctx");s(this,"width");s(this,"height");s(this,"traces",[]);s(this,"explosions",[]);s(this,"waitStopRaf");s(this,"running",!1);s(this,"opts");s(this,"sound");s(this,"resize");s(this,"mouse");s(this,"raf");this.target=t,this.container=t,this.opts=new M,this.createCanvas(this.target),this.updateOptions(i),this.sound=new P(this.opts),this.resize=new T(this.opts,this.updateSize.bind(this),this.container),this.mouse=new z(this.opts,this.canvas),this.raf=new C(this.opts,this.render.bind(this))}get isRunning(){return this.running}get version(){return"2.10.8"}get currentOptions(){return this.opts}start(){this.running||(this.canvas.isConnected||this.createCanvas(this.target),this.running=!0,this.resize.mount(),this.mouse.mount(),this.raf.mount())}stop(t=!1){this.running&&(this.running=!1,this.resize.unmount(),this.mouse.unmount(),this.raf.unmount(),this.clear(),t&&this.canvas.remove())}async waitStop(t){if(this.running)return new Promise(i=>{this.waitStopRaf=()=>{this.waitStopRaf&&(requestAnimationFrame(this.waitStopRaf),!this.traces.length&&!this.explosions.length&&(this.waitStopRaf=null,this.stop(t),i()))},this.waitStopRaf()})}pause(){this.running=!this.running,this.running?this.raf.mount():this.raf.unmount()}clear(){this.ctx&&(this.traces=[],this.explosions=[],this.ctx.clearRect(0,0,this.width,this.height))}launch(t=1){for(let i=0;i<t;i++)this.createTrace();this.waitStopRaf||(this.start(),this.waitStop())}updateOptions(t){this.opts.update(t)}updateSize({width:t=this.container.clientWidth,height:i=this.container.clientHeight}={}){this.width=t,this.height=i,this.canvas.width=t,this.canvas.height=i,this.updateBoundaries({...this.opts.boundaries,width:t,height:i})}updateBoundaries(t){this.updateOptions({boundaries:t})}createCanvas(t){t instanceof HTMLCanvasElement?(t.isConnected||document.body.append(t),this.canvas=t):(this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.container.append(this.canvas)),this.ctx=this.canvas.getContext("2d"),this.updateSize()}render(){if(!this.ctx||!this.running)return;const{opacity:t,lineStyle:i,lineWidth:e}=this.opts;this.ctx.globalCompositeOperation="destination-out",this.ctx.fillStyle=`rgba(0, 0, 0, ${t})`,this.ctx.fillRect(0,0,this.width,this.height),this.ctx.globalCompositeOperation="lighter",this.ctx.lineCap=i,this.ctx.lineJoin="round",this.ctx.lineWidth=u(e.trace.min,e.trace.max),this.initTrace(),this.drawTrace(),this.drawExplosion()}createTrace(){const{hue:t,rocketsPoint:i,boundaries:e,traceLength:h,traceSpeed:a,acceleration:r,mouse:c}=this.opts;this.traces.push(new A({x:this.width*o(i.min,i.max)/100,y:this.height,dx:this.mouse.x&&c.move||this.mouse.active?this.mouse.x:o(e.x,e.width-e.x*2),dy:this.mouse.y&&c.move||this.mouse.active?this.mouse.y:o(e.y,e.height*.5),ctx:this.ctx,hue:o(t.min,t.max),speed:a,acceleration:r,traceLength:x(h)}))}initTrace(){if(this.waitStopRaf)return;const{delay:t,mouse:i}=this.opts;(this.raf.tick>o(t.min,t.max)||this.mouse.active&&i.max>this.traces.length)&&(this.createTrace(),this.raf.tick=0)}drawTrace(){let t=this.traces.length;for(;t--;)this.traces[t].draw(),this.traces[t].update((i,e,h)=>{this.initExplosion(i,e,h),this.sound.play(),this.traces.splice(t,1)})}initExplosion(t,i,e){const{particles:h,flickering:a,lineWidth:r,explosion:c,brightness:p,friction:l,gravity:d,decay:f}=this.opts;let b=x(h);for(;b--;)this.explosions.push(new L({x:t,y:i,ctx:this.ctx,hue:e,friction:l,gravity:d,flickering:o(0,100)<=a,lineWidth:u(r.explosion.min,r.explosion.max),explosionLength:x(c),brightness:p,decay:f}))}drawExplosion(){let t=this.explosions.length;for(;t--;)this.explosions[t].draw(),this.explosions[t].update(()=>{this.explosions.splice(t,1)})}}function w(n){var t,i,e="";if(typeof n=="string"||typeof n=="number")e+=n;else if(typeof n=="object")if(Array.isArray(n)){var h=n.length;for(t=0;t<h;t++)n[t]&&(i=w(n[t]))&&(e&&(e+=" "),e+=i)}else for(i in n)n[i]&&(e&&(e+=" "),e+=i);return e}function W(){for(var n,t,i=0,e="",h=arguments.length;i<h;i++)(n=arguments[i])&&(t=w(n))&&(e&&(e+=" "),e+=t);return e}export{R as T,W as c};
